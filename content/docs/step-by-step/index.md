---
title: 'Шаг за шагом'
weight: 0
toc: true
---

## Что такое Podkop?

Podkop — это программа для маршрутизации трафика на роутерах с OpenWrt. Её основная задача — направлять трафик к нужным доменам и подсетям через прокси или VPN, поддерживая гибкую настройку и визуальный интерфейс.

#### Ключевые особенности:

- Работает на OpenWrt — поддерживаются **ванильные** прошивки 23.05 и выше
- Маршрутизирует трафик к выбранным ресурсам через:
  - VLESS
  - Shadowsocks
  - WireGuard
  - OpenVPN
  - OpenConnect
- Визуальный web-интерфейс (через LuCI), где можно указать сценарии без ручной настройки.
- Использует схему {{< link "/docs/fakeip" "FakeIP" "true" "false" >}}— переадресация и резолвинг запросов DNS через sing-box, исключая стандартный dnsmasq.

#### Предостережения и ограничения:

{{< callout type="warning" >}}
Подкоп — инструмент в **активной** разработке. Это бета-версия, и её использование требует понимания рисков.
{{< /callout >}}

##### Что нужно учитывать:
- Это тестовая версия.
  - Работает стабильно у многих пользователей, но ничего не гарантируется.
  - Вы автоматически становитесь тестировщиком после установки.
- Конфигурация может меняться.
  - После каждого обновления Podkop
    - Проверьте свои настройки.
    - Очистите кэш браузера и LuCI.
    - Убедитесь, что ваши прокси, домены и секции сохранились корректно.
- IPv6 не поддерживается.
  - Его необходимо отключить вручную {{< link "https://t.me/itdogchat/81758/138837" "инструкция" "true" "true" >}}. 
- Некоторые прошивки несовместимы.
  - Например, FriendlyWRT — сломан tproxy. {{< link "https://t.me/itdogchat/44512/181082" "инструкция" "true" "true" >}}. 
- Не используйте старые версии
  - Поддержка ведётся только для последней версии Podkop.

##### Вы готовы использовать Podkop, если:
- Готовы быть тестировщиком.
- Понимаете, что обновления могут временно всё сломать.
- Готовы давать обратную связь (или хотя бы не мешать тем, кто это делает).
- Умеете читать инструкции внимательно.

**Если хоть один пункт вызывает сомнение — лучше подождите до стабильного релиза.**

### Требования
- OpenWrt 23.05 и 24.10. Рекомендуется 24.10 из-за обновляющегося sing-box в этой версии.
- Минимум 20MB свободного места на NAND. sing-box идёт как зависимость

### Несовместимость
1. Скрипт **Getdomains** несовместим с `podkop`. Его можно удалить скриптом из репозитория {{< link "https://github.com/itdoginfo/domain-routing-openwrt" "domain-routing-openwrt" "true" "true" >}}

```
sh <(wget -O - https://raw.githubusercontent.com/itdoginfo/domain-routing-openwrt/refs/heads/master/getdomains-uninstall.sh)
```

Оставляет туннели, зоны, forwarding. А также `stubby` и `dnscrypt`. Они не помешают, но вы их можете удалить самостоятельно. Конфиг `sing-box` будет перезаписан в `podkop`.

2. Пакет `https-dns-proxy` тоже перезаписывает конфигурацию `/etc/config/dhcp` и из-за этого возникнет конфликт, приводящий к некорректной работе. Скрипт установки предложит его удалить, если он обнаружит его на роутере. Удаление вручную:

```
opkg remove --force-depends luci-app-https-dns-proxy https-dns-proxy luci-i18n-https-dns-proxy*
```

3. Legacy `iptables` пакеты, а именно `iptables-mod-extra` мешает работе `tproxy` (необходимо ещё раз провести эксперимент для даблчека).


## Установка

Пакет собирается автоматически из исходного кода. Готовые пакеты находятся в {{< link "https://github.com/itdoginfo/podkop/releases" "релизах" "true" "true" >}}

Пакет написан полностью на `ash`, поэтому файлы `podkop_*.ipk` и `luci-app-podkop_*.ipk` подходят для всех архитектур.

Тестировался на **ванильной** OpenWrt 23.05 и OpenWrt 24.10.

На FriendlyWrt 23.05 присутствуют зависимости от `iptables`, которые ломают `tproxy`. Если у вас появляется warning про это в логах, следуйте инструкции по приведённой там ссылке.

Поддержки `apk` на данный момент нет. Он будет сделан после того как разгребу основное.

### Автоматическая установка и обновление

Вставьте эту строку в консоль роутера

```
sh <(wget -O - https://raw.githubusercontent.com/itdoginfo/podkop/refs/heads/main/install.sh)
```

Если есть уже установленный `podkop`, произойдёт обновление.
