---
title: 'Секции'
weight: 2
toc: true
---

В **Podkop** можно направлять разный трафик в разные outbound (VLESS, WG, AWG, etc). Например список Geoblock вы можете послать в ваш VLESS-сервер, расположенный в Европе, Youtube к WG-серверу в РФ, а инструменты Google AI к Shadowsocks в США.

В OpenWrt LuCi есть понятие секций. Секция - это расширяемая часть конфигов openwrt. Пример упрощенного основного конфига main и экстра-секции **wg**:
```
config section 'main'
    option connection_type 'proxy'
    option proxy_config_type 'urltest'
    list community_lists 'geoblock'

config section 'wg'
    option connection_type 'vpn'
    option interface 'wg0'
    list community_lists 'youtube'
```

Секций может быть любое количество. Вы можете перенаправлять нужный вам трафик, даже если этого нет в предустановленных списках.

## Как это настраивается в LuCi

![section](images/luci-sections-example.jpg)

## Создание и удаление секций

По умолчанию, при установке, создается одна секция - **Main**.

Для имен секций используются латинские символы, цифры и знак подчеркивания.

После ввода имени вам нужно нажать кнопку **Add** для создания секции.

Для удаления секции вам нужно нажать кнопку **Delete**, которая располагается справа от имени секции.

## Настройки секций

После создания секции вам доступны следующие настройки:

### Тип подключения 

Есть три режима работы: `Proxy`, `VPN` и `Block`.

#### Proxy

В этом режиме сейчас поддерживаются следующие протоколы: `VLESS`, `Shadowsocks`, `Trojan` и `Socks` 4й и 5й версии.


Доступно три варианта настройки:

- **URL подключения | Connection URL**

  Используется для ссылок вида: `vless://  ss:// trojan:// socks(4|5)://`. Просто вставьте свою ссылку.

> [!NOTE]
> Если ваша строка не поддерживается, пришлите пример строки (без чувствительных данных) и конфигурацию inbound для `Xray` или `sing-box` в чат, чтобы мы могли воспроизвести и протестировать эту конфигурацию. Также вы можете использовать кастомный outbound.


- **Конфигурация Outbound | Outbound Config**

  Позволяет внести Outbound, поддерживамый `sing-box`, в формате JSON.

  Воспользуйтесь [примерами](https://sing-box.sagernet.org/configuration/outbound/) Outbound из его документации.

- **URLTest**

  Позволяет указать несколько ссылок `vless://  ss:// trojan:// socks(4|5)://`. В данном режиме `sing-box`  отправляет запрос к указанному серверу и измеряет скорость отклика, наличие ошибок и другие параметры соединения и на основании данных тестов выбирает сервер.

  Полезно использовать для резервирования: в случае если один из прокси станет недоступен, `sing-box` автоматически переключит ссылку на действующую.

  При выбранном режиме **URLTest** так же доступны дополнительные настройки:

>[!Note]
>Данные параметры могут не отрабатывать должным образом. Вы можете обратиться к [документации](https://sing-box.sagernet.org/configuration/outbound/urltest/) sing-box или в deepwiki, если вам захочется в этом разобраться.  

  - **Интервал проверки URLTest | URLTest Check Interval**

    Интервал между проверками отклика указанных вами серверов.

  - **Порог переключения URLTest | URLTest Tolerance**

    Значение задержки, которое используется `sing-box` при принятии решении о переключении на другой сервер.

    Если разница задержки между действующим сервером и другим, указанным для URLTest, будет больше указанного здесь значения, `sing-box` переключит сервер.

  - **URL для тестирования URLTest | URLTest Testing URL**

    Адрес, который использует `sing-box` для тестирования соединения для указанных вами ссылок.

    Вы можете вручную выбрать прокси, используя [dashboard](/docs/dashboard) или [yacd](/docs/yacd#ручное-переключение-прокси).


При выбранном режиме `Proxy` доступна еще одна настройка: 

- **UDP over TCP**

Используется для передачи UDP-пакетов в TCP соединении. Если UDP заблокирован, а TCP - нет, то данная опция может помочь.

Возможно использовать с `Shadowsocks` и `Socks`.

По умолчанию для `Shadowsocks` отключена функция `UDP over TCP`. Включается с помощью этой галочки. Может быть полезна пользователям `Outline`. 


#### VPN

В этом режиме вы выбираете предварительно настроенный интерфейс. Это может быть `Wireguard`, `AmneziaWG`, `OpenVPN`, `OpenConnect` и любой другой туннель или VPN. Достаточно настроить только сам туннель или VPN, настройки firewall и зон не обязательны.

- **Сетевой интерфейс | Network Interface**

  Список интерфейсов для выбора

- **Резолвер доменов | Domain Resolver**

  Параметр, позволяющий включить отдельный DNS-сервер для выбранного интерфейса. 

  Все запросы, направляемые в этот интерфейс, будут разрешаться через выбранный DNS-сервер. Настройка DNS-сервера для 
  резолвера доменов аналогична [обычной настройке DNS-сервера](/docs/settings/#тип-протокола-dns-dns-protocol-type).

  DNS-запросы, отправляемые резолвером доменов, по умолчанию направляются в этот же туннель.

#### Block

Этот режим позволяет заблокировать определенные домены и/или подсети. Они будут направлены в Sing-box и отброшены.

### Списки сообщества

Готовые списки для проксирования.

Список Russia inside включает в себя следующие подсписки:

- GEO Block
- Block
- Porn
- News
- Anime
- Youtube
- Meta*
- Twitter(X)
- HDRezka
- Tik-Tok

Подсписки Meta*, Twitter, Cloudflare и Discord содержат так же подсети указанных сервисов, которые по-умолчанию отсутствуют в Russia inside.
Подсети необходимы если вам нужны рабочие голосовые чаты в Discord или какой-то из вышеназванных трех сервисов работает плохо, что-то не загружается или тормозит.

Таким образом, при использовании Russia inside вы можете выбрать дополнительно следующие списки:
- Meta*
- Twitter
- Discord
- Telegram
- Cloudflare
- Google AI
- Google Play
- H.O.D.C.A. (Список доменов за CF, AWS и т.д.)
- Hetzner ASN
- OVH ASN
- Digital Ocean ASN
- CloudFront ASN

Вместе нельзя выбрать и использовать:
- Russia inside
- Russia outside
- Ukraine

Что делать если вам нужно добавить отдельный туннель для сервиса  который присутствует в Russia inside?

Вам необходимо отказаться от использования списка Russia inside и вместо него использовать вышеуказанные подсписки, собрав то, что вам необходимо и исключив сервис, который вам нужно пустить в отдельный туннель.

Если вы хотите более подробно ознакомиться с тем, какие сайты включены в тот или иной список, вы можете сделать это здесь:
https://github.com/itdoginfo/allow-domains/


---

\* Meta Platforms Inc. — организация, признанная экстремистской и запрещённая на территории РФ.

### Тип пользовательского списка доменов | User Domain List Type

Если вы не хотите использовать готовые списки или какие-то домены отсутствуют в них, вы можете добавлять свои.

Доступно два режима добавления:

- **Текстовый список | Text List**

  Удобен в случае, если у вас много доменов или вам нужно скопировать их из файла. В качестве разделителя можно использовать запятую, пробел или указать каждый домен с новой строки. Доступны комментарии, при использовании символов `//` перед текстом.

- **Динамический список | Dynamic List**

  Используется для добавления доменов по одному.

Домены указываются в следующем виде:

```
example.com
sub.example.com
```


### Тип пользовательского списка подсетей | User Subnet List Type

Аналогично доменам, вы можете добавить список подсетей.

Подсети указываются в следующем виде:
```
103.21.244.0/22
103.21.244.89
```

Доступно два режима добавления:

- **Текстовый список | Text List**

  Удобен в случае, если у вас много подсетей или вам нужно скопировать их из файла. В качестве разделителя можно использовать запятую, пробел или указать каждую подсеть с новой строки. Доступны комментарии, при использовании символов `//` перед текстом.

- **Динамический список | Dynamic List**

  Используется для добавления подсетей или IP адресов по одному.

### Локальные списки доменов | Local Domain Lists

Вы можете поместить список доменов в файл вида file.lst или file.txt, где каждый домен будет начинаться с новой строки. Пример того как выглядит данный файл вы можете найти в разделе ниже.

### Локальные списки подсетей | Local Subnet Lists

Вы можете поместить список подсетей в файл вида file.lst или file.txt, где каждый домен будет начинаться с новой строки. Пример того как выглядит данный файл вы можете найти в разделе ниже.

### Внешние списки доменов | Remote Domains Lists

Доступен вариант загрузки списка доменов с `GitHub` или вашего личного сайта. Необходимо указать полный адрес, с указанием протокола (`http://` или `https://`).

Поддерживаются файлы формата **.json | .srs | .lst | .txt**:

  - **.json**
  
  ```
 {
 "version":3,
  "rules": [
    {
    "domain_suffix": [
      "sub.example.com",
      "example.com"
        ]
      }
    ]
}
  ```

  - **.srs**

  Бинарный формат для хранения набора правил sing-box.

  Один из способов его получения это использовать `sing-box` и файл в формате **.json**, пример которого приведен выше:
  ```
  sing-box rule-set compile [--output <file-name>.srs] <file-name>.json
  ```

 Или воспользоваться готовыми решениями: [пример](https://github.com/MetaCubeX/meta-rules-dat/tree/sing ).


  - **.lst | .txt**
  
  Представляет собой простой текстовый файл, где каждый домен указан с новой строки
  ```
example.com
sub.example.com
  ```


### Внешние списки подсетей | Remote Subnet Lists

Доступен вариант загрузки списка подсетей с `GitHub` или вашего личного сайта. Необходимо указать `CIDR` или одиночный IP. Необходимо указать полный адрес, с указанием протокола (`http://` или `https://`).

Поддерживаются файлы формата **.json | .srs | .lst | .txt**.

  - **.json**
  
  ```
{
"version":3,
  "rules": [
    {
    "ip_cidr": [
      "10.0.0.0/24",
      "192.168.0.1"
        ]
      }
    ]
  }
  ```

  - **.srs**

  Бинарный формат для хранения набора правил sing-box.

  Один из способов его получения это использовать `sing-box` и файл в формате **.json**, пример которого приведен выше:
  ```
  sing-box rule-set compile [--output <file-name>.srs] <file-name>.json
  ```

 Или воспользоваться готовыми решениями: [пример](https://github.com/MetaCubeX/meta-rules-dat/tree/sing ).


  - **.lst | .txt**
  
  Представляет собой простой текстовый файл, где каждая подсеть указана с новой строки в следующем виде:

  ```
  103.21.244.0/22
  103.21.244.89
  ```

### Полностью маршрутизируемые IP-адреса | IP for full redirection

Направляет весь трафик с конкретного устройства в туннель. Для этого требуется указать локальные IP устройств или подсети.

Чтобы узнать IP устройства, вам нужно зайти в веб-интерфейс роутера и перейти в **Status -> Overview или Network -> DHCP and DNS -> Static Leases**. В разделе `Active DHCP Leases` отображаются выданные вашим устройствам IP. При необходимости вы можете сделать их статическими нажав кнопку **Set Static** или **Add** и добавить необходимое устройство.

### Включить смешанный прокси | Mixed enable

Позволяет поднять на роутере `HTTP | SOCKS` прокси, который будет использовать туннель указанный в данной секции.

Если вам нужно направить трафик с конкретного приложения в туннель, то вы можете использовать данную опцию. В качестве адреса прокси будет выступать IP вашего роутера и порт, указанный в данной опции.
